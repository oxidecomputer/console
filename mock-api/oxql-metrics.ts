/*
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, you can obtain one at https://mozilla.org/MPL/2.0/.
 *
 * Copyright Oxide Computer Company
 */
import type { OxqlQueryResult } from '~/api'
import type { OxqlMetricName, OxqlVcpuState } from '~/components/oxql-metrics/util'

import { instances } from './instance'
import type { Json } from './json-type'

const oneHourAgo = new Date()
oneHourAgo.setHours(oneHourAgo.getHours() - 1)
const now = new Date()
const timestamps: string[] = []
// Generate timestamps for the last hour
for (let i = oneHourAgo.getTime(); i < now.getTime(); i += 60000) {
  timestamps.push(new Date(i).toISOString())
}

type ValueType = Record<OxqlMetricName, number[]>

const mockOxqlValues: ValueType = {
  'instance_network_interface:bytes_received': [
    19589220.623748355, 24553203.242848497, 89094997.39982976, 88911367.62801822,
    89564328.13052855, 36132222.97561263, 35083093.4423788, 45992685.125303574,
    52667932.85079793, 53255578.251586914, 50642139.72662767, 53016799.10056307,
    53453471.83148456, 17812773.001480814, 17652089.511599142, 17400992.998094894,
    23783344.52673782, 87510120.57284649, 88415586.70307633, 89809422.42279987,
    36294110.18462029, 35816494.883518465, 50898547.59673651, 52888621.42617168,
    52022765.40817507, 51545607.28884054, 50940589.28290987, 45175697.87988242,
    18574000.425671637, 18727470.05461767, 19270084.616364624, 19699874.56110518,
    89088859.22025315, 88411150.33482315, 88127023.98263156, 42293581.61247408,
    38734001.65471564, 49297923.93599405, 51553782.50758036, 51244054.148059346,
    51728001.475473344, 51534232.55254867, 51047390.06649641, 10061318.072499434,
    9044264.254223755, 9134684.412748203, 9050554.118707722, 9035379.9069059,
    9110098.444441319, 9041842.197785899, 9035280.981180245, 9020950.700432273,
    8977950.29915887, 27381863.86000137, 89824944.62147991, 88766745.59432606,
    79294879.24604356, 16279008.5071202, 16297706.567097535, 14187828.016217524,
  ],
  'instance_network_interface:bytes_sent': [
    61967407.4690769, 62659750.37321169, 94615638.21567552, 94830488.5349947,
    95073373.66159962, 114515161.09650381, 114513480.4104714, 67598551.7442919,
    60878378.37459309, 61284428.313176505, 58812438.49990403, 61108040.21864518,
    61438901.75645653, 61604633.377452575, 65329473.79495335, 64454685.17365676,
    66649624.01594997, 93106698.60171998, 94118093.74878043, 95640017.17327368,
    127418480.32586104, 125125303.39594136, 60007588.507188044, 60696339.00900922,
    59533389.07721457, 59727164.03291828, 59385691.85417155, 56385978.939908296,
    58482326.04577281, 58931768.40465623, 60684771.505763024, 57382770.31131127,
    95175199.9700111, 94054057.74380775, 93627971.79398167, 114539414.03000657,
    122141655.90741396, 65057155.0238452, 59508603.56693583, 58810729.534921914,
    60332025.83279615, 59443444.112106115, 61066382.357687324, 889838412.7357846,
    919649082.456614, 927770089.9058081, 916228327.514903, 917966272.0036994,
    920090782.1096474, 917910750.6941862, 920093111.3043944, 916360373.2879275,
    913486103.4169887, 701279770.7176225, 94828852.77350871, 94669806.35246424,
    264210805.15261075, 1652357411.4296043, 1652078679.222105, 1441081863.6751692,
  ],
  'instance_network_interface:errors_received': [],
  'instance_network_interface:errors_sent': [],
  'instance_network_interface:packets_dropped': [
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0,
  ],
  'instance_network_interface:packets_received': [
    51626.338736467435, 56229.94338102455, 128282.11254611396, 128564.80636165978,
    128989.41383010168, 94510.81161989772, 93665.31941652698, 81383.75535723146,
    85221.6209098, 85822.6271386839, 81979.71993495703, 85474.23160386541,
    85925.16400885995, 47190.750325350964, 48573.93626348796, 47820.90911392931,
    54921.4389477908, 126219.29470494478, 127521.29665159812, 129587.02976700662,
    96154.70608651743, 94899.91699370155, 83202.28709218279, 85022.07185646542,
    83143.82839526674, 83634.04637295769, 82936.67722227327, 75158.50165989484,
    46606.838817035314, 46982.238183297195, 48419.786227343524, 47103.65158021678,
    128437.39090478497, 127591.93090182958, 127012.8207799399, 96573.31083839823,
    97082.5916684147, 83120.52587402581, 83263.52753849649, 82238.52685222514,
    84450.35016762071, 83067.65700170219, 82959.56398332072, 43759.59507033672,
    42923.47803011315, 43431.627985928084, 43069.7969693797, 43059.457017705565,
    43602.54319799071, 42897.2872618157, 42942.59379466726, 43066.817156663514,
    42566.8082280084, 61438.10807642717, 128724.06662712415, 128398.5929964637,
    119640.40559043291, 77724.4463363611, 77964.54792540593, 67988.15593674716,
  ],
  'instance_network_interface:packets_sent': [
    52137.86783412454, 60154.82944915184, 170294.14156959817, 170629.15143145437,
    171299.78746072564, 95653.37095286128, 94097.58449760282, 99751.44401011993,
    110115.72250064427, 111057.99080788075, 106270.53166977571, 110597.50442558025,
    111123.32382798912, 48025.948755741374, 48572.51133205648, 47830.51582947457,
    58746.02990920361, 167518.38571626123, 169424.45152829404, 172155.99300919194,
    97316.28791466833, 96245.79297178097, 107429.92883606884, 109784.39976567338,
    107553.39026304561, 108101.21920026942, 107437.55840575877, 95608.73106548574,
    46657.90593104405, 46993.78703923178, 48436.42161541242, 48224.26619269178,
    170430.61313726509, 169333.80006289986, 168692.38480195502, 100688.99025787185,
    96994.62254120565, 104651.51085988498, 107656.18505288263, 106218.07389709905,
    109280.36747812887, 107509.04304010724, 108436.27060103651, 599505.2441023788,
    617622.3592543039, 623021.7338257399, 615594.7135637688, 616645.60095252,
    618255.2460245651, 616543.6810593881, 617902.5773599739, 615661.570085495,
    613548.5849304599, 495794.7258951948, 171019.15081407645, 170315.39920711354,
    270113.18497460126, 1109817.5984217522, 1109609.9278124508, 967843.945139089,
  ],
  // Current bytes_read and reads aren't super helpful; find a better one
  'virtual_disk:bytes_read': [
    134668408.94260278, 134114600.98348178, 134708158.30609903, 134746207.08323193,
    134757768.45246968, 135554970.52717522, 134400831.89327943, 134491792.51736572,
    134338108.90250394, 135251533.05339137, 134282853.1940323, 134601751.89569664,
    134120627.28247309, 135038025.54527146, 134611932.4494742, 135500486.29084927,
    134875807.5854877, 134621603.81059673, 134738692.42169353, 134534877.9584674,
    134424164.3767796, 134465893.49951467, 134757304.5764649, 135374966.46820828,
    134186580.68346651, 134756565.30676734, 135074451.95680845, 134506691.99236247,
    134657886.35695586, 134390897.60452515, 135226063.33329535, 135490924.9492251,
    135093288.02499872, 135100378.1836631, 134114153.76629321, 135362836.38550094,
    134744217.06305423, 134451662.97109315, 134829077.22112235, 134418157.3689324,
    134916146.93966413, 134440891.3867167, 134787176.5549223, 134660350.45820063,
    133810022.8238135, 134168764.48050334, 135189035.65126267, 134021049.90450476,
    134903916.71328273, 134656718.33510137, 134943815.04202753, 134797406.3526269,
    134497553.75692537, 134920089.16782558, 133689536.22922617, 134521160.31905597,
    134616922.7392796, 134751380.6347449, 134657054.91462126, 127405348.82547487,
  ],
  'virtual_disk:bytes_written': [
    330917410.0482145, 329709105.37664956, 331010610.525867, 331211447.18977416,
    331261458.46301866, 333203011.6858776, 330456579.5368512, 330592407.1195608,
    330065103.9267523, 332386493.7934591, 330080544.3288696, 330856509.54466516,
    329583271.1448502, 331910771.9026434, 330734831.34536916, 333011595.5327931,
    331531620.2096405, 331001777.99884146, 331080665.690497, 330676206.2135374,
    330371180.3795449, 330571852.06149286, 331177327.99516386, 332699589.00015104,
    329821302.64082146, 331333622.32089734, 331917511.87458974, 330670793.11512905,
    330897663.28819346, 330432756.5197515, 332382792.14725393, 332948541.27419853,
    332114288.1251069, 332207939.69306546, 329606223.2347984, 332657542.783183,
    331140266.22763973, 330498134.19539064, 331298446.3134648, 330326704.5539919,
    331676323.2274062, 330452510.56756794, 331234773.76926625, 330999989.46997416,
    328842918.9281494, 329990105.5430548, 332240433.71217155, 329266790.9013924,
    331503173.65867263, 331081244.1591726, 331573649.42449266, 331311794.6993156,
    330621841.69141155, 331641719.1576536, 328762769.94054705, 330623704.34390384,
    330847001.6152951, 331134733.01985526, 331042258.9105762, 313118482.8823368,
  ],
  'virtual_disk:failed_flushes': [],
  'virtual_disk:failed_reads': [],
  'virtual_disk:failed_writes': [],
  'virtual_disk:flushes': [
    2.5656143915805463, 1.9999135844522231, 1.9999446704324797, 1.9999073598971984,
    2.1666111719868897, 2.4999294767917375, 1.9999226151786687, 1.999938312586908,
    1.999915522549354, 1.9999275117618545, 2.3332884612693365, 1.9999124233153838,
    1.999944451971838, 1.9999203504646035, 2.166586557020626, 2.4999415493091197,
    1.999913840239971, 1.999914091891102, 1.9999696801143712, 1.9999003696836775,
    2.3332789978652286, 1.9999212082005924, 1.9999288190914821, 1.9999268048571393,
    2.1666043432612048, 2.3332758513205545, 1.9999206482596599, 1.9999187185712357,
    1.9999448261708366, 1.9999289269036664, 2.16658295228307, 1.9999438917460528,
    1.9999163542044818, 1.9999354273728318, 2.1665857733228306, 2.499940138876416,
    1.9999269799553812, 1.9999326381486526, 1.9999066832216723, 1.9999346044578068,
    2.1666116384639307, 1.9999251699281135, 1.999935875819479, 1.9999353427672795,
    2.166590416093396, 2.158013910180325, 2.3418311421693914, 1.9999320742404887,
    1.99992307542628, 1.9999462544352449, 2.104945905608691, 2.2282473403754888,
    1.9999123729582473, 1.9999424608149798, 2.1665833832461114, 2.156921598533039,
    2.5096092476281466, 1.9999174120513497, 1.947702169825175, 1.7811086517690107,
  ],
  'virtual_disk:io_latency': [],
  'virtual_disk:io_size': [],
  'virtual_disk:reads': [
    32875.24156785288, 32742.822328425584, 32887.73594062226, 32897.01974676766,
    32899.84724796665, 33094.47384514138, 32812.70485366211, 32834.916712611426,
    32797.39635816606, 33020.40179708033, 32783.878124461684, 32861.77521851955,
    32744.281992359556, 32968.260751779875, 32864.23786157581, 33081.17527008203,
    32928.69283690152, 32866.58995986923, 32895.17448355364, 32845.429148303105,
    32818.40214316456, 32828.58538573866, 32899.731331754025, 33050.526570446236,
    32760.398000638772, 32899.54913489171, 32977.16272905804, 32838.54751554444,
    32875.460840451786, 32810.27714114574, 33014.17444085401, 33078.83922496485,
    32981.76696360247, 32983.48461803678, 32742.71720367538, 33047.564057713025,
    32896.53737696453, 32825.10937564101, 32917.25798549699, 32816.93647036122,
    32938.520033769215, 32822.474496116076, 32907.021717779, 32876.0623673061,
    32668.46702400371, 32756.04290102374, 33005.1346861714, 32719.98266455284,
    32935.52571082768, 32875.18333304324, 32945.261869929476, 32909.522866100415,
    32836.316731826875, 32939.4800212177, 32639.043333491893, 32842.07741645839,
    32865.460697366696, 32898.286514038606, 32875.25480902649, 31104.79807562703,
  ],
  'virtual_disk:writes': [
    80779.20034056324, 80488.39802006751, 80805.80225310395, 80855.15821565613,
    80864.79880246993, 81337.46751659793, 80670.72338169033, 80703.19837050632,
    80575.48791844303, 81141.19990943027, 80578.06175089431, 80766.87480048476,
    80458.1290404043, 81025.74988033365, 80736.79941004828, 81292.50035163287,
    80933.50479856148, 80802.81559906728, 80822.73100302315, 80724.33802652155,
    80648.69871675129, 80698.66854576267, 80847.01468567258, 81216.99268513004,
    80513.73959795143, 80883.5923126427, 81027.21407677184, 80722.84066884329,
    80777.89346683757, 80664.96049183104, 81140.42624987042, 81279.5057398679,
    81074.68704853921, 81098.17386192539, 80461.52192157002, 81205.76385295736,
    80838.0203641813, 80680.73319761816, 80875.17961103571, 80638.83573602898,
    80968.38368631831, 80669.89293196103, 80860.46783615886, 80802.87760515751,
    80274.85330533002, 80553.90436153534, 81106.55873376083, 80380.39855063528,
    80926.057056781, 80823.21953454925, 80942.22206587721, 80879.53974235548,
    80711.39311776291, 80959.22322515622, 80255.65776427352, 80710.42477501076,
    80762.95003772335, 80835.45706264429, 80813.69749658779, 76437.65290335608,
  ],
  'virtual_machine:vcpu_usage': [
    2499905522.069563, 2499907852.721323, 2499905908.54074, 2499907012.272795,
    2499804955.7642694, 2500006591.594678, 2499906131.411963, 2499902228.3899193,
    2499908286.203884, 2499905192.5396056, 2499906236.8402143, 2499905349.749606,
    2499910029.944799, 2499367697.670227, 2500416144.5857825, 2499884071.387617,
    2499956987.646689, 2499906624.0122085, 2499906718.595123, 2499030963.4460144,
    2500781041.95272, 2499905905.009748, 2499909210.3611917, 2499902349.771641,
    2499904900.435377, 2499906177.384982, 2499900165.067388, 2499875929.9844794,
    2499853876.440561, 2498203135.340737, 2501608845.881842, 2499992890.270853,
    2499907251.114202, 2499904472.39941, 2499907646.4373717, 2499904279.635703,
    2499909550.02471, 2499906380.424079, 2499906981.441006, 2727099083.468231,
    2500039782.0117164, 2500037237.8000717, 2499896821.604633, 2500848122.034206,
    2500704464.721572, 2500695916.004956, 2500869992.918002, 2500757500.417847,
    2500764791.38011, 2500812080.323136, 2500875068.001767, 2500655429.7678127,
    2500780813.778851, 2500488840.443952, 2499831672.506039, 2499955440.670328,
    2500726928.243442, 2502667701.580808, 2502288568.756825, 2322688896.301265,
  ],
}
const mockOxqlVcpuStateValues: Record<OxqlVcpuState, number[]> = {
  emulation: [
    433819354.143517, 474258863.689448, 935547266.145289, 937384987.820391,
    917354398.674702, 721156913.248746, 724208356.457597, 764978621.523673,
    774104870.950881, 784136314.717026, 782642074.341145, 784961252.861576,
    768829428.688853, 327171683.153106, 328217796.638532, 353024215.589421,
    436196231.906917, 936530837.541679, 923642907.409809, 926598649.668951,
    668036285.143684, 668601419.245331, 776851027.492487, 767851643.549842,
    782893479.189671, 767512794.503401, 762233485.338436, 689022730.290552,
    334396875.872094, 342569262.156457, 366981630.971594, 369008959.745454,
    943281667.400296, 935794957.576598, 932965752.205426, 680522299.321474,
    682350449.636953, 758627748.547292, 788889883.173164, 826033229.013845,
    767506798.309009, 769514519.845416, 748044537.273431, 325044957.290516,
    323103553.909169, 326571815.189428, 321828283.383327, 321928043.977475,
    322007541.130229, 320938030.258854, 319550587.058472, 323096176.489687,
    321697656.535225, 484467822.834563, 935036356.907895, 935366291.714764,
    839025592.760722, 515297053.598658, 519046508.201978, 482933057.178273,
  ],
  run: [
    577459515.341908, 607193184.667774, 1050318090.989816, 1058676033.96782,
    1049713685.94866, 1029427682.22122, 1015115349.942776, 784056585.12971,
    783404643.613152, 800737827.931207, 779402464.673423, 799757803.782135,
    791193126.675789, 467882218.695389, 483353787.382051, 484742070.318424,
    553212152.878067, 1041403878.39064, 1091404754.60691, 1054534492.62368,
    965598397.536295, 927630078.498679, 775887244.723142, 783712296.411258,
    779213569.919366, 780637430.249757, 775829481.059841, 708956007.858894,
    485038224.401587, 484468962.403804, 498548688.909118, 496016737.332339,
    1057581700.06776, 1060366769.729115, 1058785213.38929, 964530837.109668,
    984890188.052316, 771994622.673891, 784340795.763329, 835992149.397523,
    788014509.881821, 778607075.176974, 774716528.736605, 564489660.215151,
    565769604.704735, 573368709.264709, 566722257.617596, 567622814.419021,
    563746349.893965, 568208618.539015, 569784445.534938, 569717063.542321,
    568365648.685729, 680835976.940007, 1049186033.143595, 1061951833.93995,
    1039771908.606844, 1014450266.39571, 1024423060.487725, 953825295.427142,
  ],
  idle: [
    1486310796.717019, 1415917066.7781, 509029501.912428, 498858581.892948,
    527821697.656155, 745327321.578967, 756572487.809488, 947484041.890783,
    938933215.864781, 911487616.998758, 934506190.759049, 911666829.751613,
    936424627.288366, 1702472187.320687, 1686939069.248446, 1660134028.186731,
    1508215410.282407, 516990657.6577, 479861197.871914, 512886030.174005, 863071779.014002,
    899755086.585903, 943780855.213123, 944888595.965678, 934431763.099574,
    948368563.352489, 958430998.816782, 1098867996.135358, 1678486086.727562,
    1669198387.182792, 1634049132.257868, 1632911975.926217, 494029592.50713,
    498538794.62026, 503046068.892604, 850817430.957239, 828643558.923179, 965908655.085106,
    923257088.691666, 1061338169.671841, 940977335.233242, 948363268.964591,
    973551502.460249, 1609412163.341032, 1609905085.683272, 1598741600.294178,
    1610344308.665359, 1609213603.067848, 1612988558.715188, 1609653085.794655,
    1609560849.105236, 1605892894.682423, 1608764863.739829, 1332528059.477199,
    510664094.746908, 497505429.363717, 616741201.782988, 968531921.332227,
    954743321.603357, 881987115.757594,
  ],
  waiting: [
    2315855.867119, 2538737.586001, 5011049.493207, 4987408.591636, 4915173.484752,
    4094674.545745, 4009937.202102, 3382979.845753, 3465555.77507, 3543432.892615,
    3355507.066597, 3519463.354282, 3462847.291791, 1841608.501045, 1905491.316754,
    1983757.293041, 2333192.579298, 4981250.422189, 4997858.70649, 5011790.979378,
    4074580.258739, 3919320.679835, 3390082.93244, 3449813.844863, 3366088.226766,
    3387389.279335, 3406199.852329, 3029195.699675, 1932689.439318, 1966523.597684,
    2029393.743262, 2055217.266843, 5014291.139016, 5203950.473437, 5110611.950052,
    4033712.247322, 4025353.412262, 3375354.11779, 3419213.812847, 3735535.385022,
    3541138.587644, 3552373.813091, 3584253.134348, 1901341.187507, 1926220.424396,
    2013791.256641, 1975143.25172, 1993038.953503, 2022341.640728, 2012345.730612,
    1979186.303121, 1949295.053382, 1952644.818068, 2656981.192183, 4945187.707641,
    5131885.651897, 5188225.092888, 4388460.254213, 4075678.463765, 3943427.938256,
  ],
}

export const getMockOxqlInstanceData = (
  name: OxqlMetricName,
  state?: OxqlVcpuState
): Json<OxqlQueryResult> => {
  const values = state ? mockOxqlVcpuStateValues[state] : mockOxqlValues[name]
  // structuredClone lets us mutate data in the calling code without messing up
  // the source data
  return structuredClone({
    tables: [
      {
        name: name,
        timeseries: {
          // This is a fake metric ID
          '10607783231231666598': {
            fields: {
              instanceId: {
                type: 'uuid',
                value: instances[0].id, // project: mock-project; instance: db1
              },
            },
            points: {
              start_times: [],
              timestamps: timestamps,
              values: [
                {
                  values: {
                    type: 'double',
                    values: values,
                  },
                  metric_type: 'gauge',
                },
              ],
            },
          },
        },
      },
    ],
  })
}
