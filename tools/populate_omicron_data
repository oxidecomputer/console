# this script requires both the nexus server and the sled agent to be running
#
# Setup (in omicron directory). First install rustup: https://rustup.rs/. Then:
#
#   rustup install stable
#   cargo build
#   npm i -g json
# 
# Then run both of the following
#
#   cargo run --bin=nexus -- examples/config.toml
#   cargo run --bin=sled_agent -- $(uuidgen) 127.0.0.1:12345 127.0.0.1:12221
#
# note that because all of this is in memory, this script needs to be run
# every time omicron is started. data is not currently persisted
#
# since we're not being clever with the paths yet, this script assumes omicron
# is in the same dir as as the console repo 

../omicron/tools/oxapi_demo project_create_demo prod-online
../omicron/tools/oxapi_demo project_create_demo release-infrastructure 
../omicron/tools/oxapi_demo project_create_demo rendering
../omicron/tools/oxapi_demo project_create_demo test-infrastructure
../omicron/tools/oxapi_demo project_create_demo oxide-demo

../omicron/tools/oxapi_demo instance_create_demo prod-online db1

../omicron/tools/oxapi_demo disk_create_demo prod-online nginx
../omicron/tools/oxapi_demo disk_create_demo prod-online grafana
../omicron/tools/oxapi_demo disk_create_demo prod-online grafana-state
../omicron/tools/oxapi_demo disk_create_demo prod-online vault

../omicron/tools/oxapi_demo instance_attach_disk prod-online db1 nginx
../omicron/tools/oxapi_demo instance_attach_disk prod-online db1 grafana
../omicron/tools/oxapi_demo instance_attach_disk prod-online db1 grafana-state
../omicron/tools/oxapi_demo instance_attach_disk prod-online db1 vault